<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§ç»éªŒè®¡ç®—å™¨ - According.Work æ¸¸æˆåŒ–å¹³å°</title>
    <link rel="stylesheet" href="css/common.css">
    <style>
        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .system-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .overview-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .overview-desc {
            font-size: 16px;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .key-point {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .key-point-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .key-point-title {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .key-point-desc {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .parameter-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .parameter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .parameter-item {
            display: flex;
            flex-direction: column;
        }
        
        .parameter-item label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .parameter-item input[type="range"] {
            margin: 5px 0;
        }
        
        .parameter-item .value-display {
            font-size: 14px;
            color: #666;
            text-align: center;
            padding: 5px;
            background: #fff;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .level-table, .exp-actions {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .level-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .level-table th,
        .level-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .level-table th {
            background: #f1f3f4;
            font-weight: bold;
        }
        
        .level-table tr:hover {
            background: #f8f9fa;
        }
        
        .formula-display {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #f1f3f4;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e8eaed;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            padding: 8px 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn:hover {
            background: #1976D2;
        }
        
        .exp-source {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .exp-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .exp-item:last-child {
            border-bottom: none;
        }
        
        .exp-action {
            font-weight: 500;
        }
        
        .exp-value {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .level-benefits {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .benefit-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #FF9800;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .effort-emphasis {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
            border-left: 4px solid #4CAF50;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .emphasis-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .emphasis-text {
            color: #388e3c;
            line-height: 1.6;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .chart-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .chart-controls label {
            font-weight: bold;
            color: #333;
        }
        
        .chart-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        
        .chart-wrapper {
            position: relative;
            background: #fafafa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        #expChart {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        
        .chart-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-weight: bold;
            color: #666;
            display: block;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="index.html">According.Work æ¸¸æˆåŒ–å¹³å°</a>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">é¦–é¡µ</a></li>
                    <li><a href="level-calculator.html" class="active">ç­‰çº§è®¡ç®—å™¨</a></li>
                    <li><a href="task-center.html">ä»»åŠ¡ä¸­å¿ƒ</a></li>
                    <li><a href="character-panel.html">äººç‰©é¢æ¿</a></li>
                    <li><a href="token-system.html">ä»¤ç‰Œç³»ç»Ÿ</a></li>
                    <li><a href="github-skills.html">GitHubæŠ€èƒ½</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="calculator-container">
        <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
        <div class="system-overview">
            <div class="overview-title">ğŸ® ç­‰çº§ç»éªŒç³»ç»Ÿ</div>
            <div class="overview-desc">
                è¡¡é‡ç”¨æˆ·åœ¨å¹³å°ä¸Šçš„å‚ä¸ç¨‹åº¦ï¼ŒæŠ½ç¦»èƒ½åŠ›çš„è¡¡é‡ï¼Œä¸»è¦ä½“ç°åŠªåŠ›ç¨‹åº¦ã€‚ä¸å£°èª‰ä¸åŒï¼Œè¿™ä¸ªæŒ‡æ ‡åªå‡ä¸é™ã€‚
            </div>
            <div class="key-points">
                <div class="key-point">
                    <div class="key-point-icon">ğŸ“ˆ</div>
                    <div class="key-point-title">åŠªåŠ›ç¨‹åº¦é‡åŒ–</div>
                    <div class="key-point-desc">é€šè¿‡ä»»åŠ¡å®Œæˆã€ä»£ç å®¡æŸ¥ç­‰è¡ŒåŠ¨ç§¯ç´¯ç»éªŒ</div>
                </div>
                <div class="key-point">
                    <div class="key-point-icon">ğŸ¯</div>
                    <div class="key-point-title">æƒç›Šå€ç‡æå‡</div>
                    <div class="key-point-desc">ç­‰çº§è¶Šé«˜ï¼Œä»»åŠ¡å¥–åŠ±å€ç‡è¶Šé«˜</div>
                </div>
                <div class="key-point">
                    <div class="key-point-icon">ğŸ”“</div>
                    <div class="key-point-title">æœºåˆ¶é€æ­¥è§£é”</div>
                    <div class="key-point-desc">ä¸åŒç­‰çº§è§£é”ä»¤ç‰Œç³»ç»Ÿã€å£°èª‰ç³»ç»Ÿç­‰</div>
                </div>
            </div>
        </div>

        <div class="effort-emphasis">
            <div class="emphasis-title">âš ï¸ é‡è¦è¯´æ˜ï¼šç­‰çº§ â‰  æŠ€èƒ½èƒ½åŠ›</div>
            <div class="emphasis-text">
                ç­‰çº§ç³»ç»Ÿä»…åæ˜ å‚ä¸åº¦å’ŒåŠªåŠ›ç¨‹åº¦ï¼Œä¸ä»£è¡¨æŠ€æœ¯èƒ½åŠ›ã€‚å„æŠ€æœ¯æ ˆçš„å®é™…èƒ½åŠ›é€šè¿‡GitHubä»“åº“æ•°æ®æ¥è¯„ä¼°ï¼Œ
                åŒ…æ‹¬ä»£ç è´¨é‡ã€é¡¹ç›®å¤æ‚åº¦ã€è´¡çŒ®é¢‘ç‡ç­‰å®¢è§‚æŒ‡æ ‡ã€‚è¿™æ ·è®¾è®¡å¯ä»¥é¿å…æŠ€èƒ½å„æ–­ï¼Œè®©æ–°æ‰‹ä¹Ÿèƒ½é€šè¿‡åŠªåŠ›è·å¾—å¹³å°æƒç›Šã€‚
            </div>
        </div>

        <div class="parameter-panel">
            <h3>ğŸ“Š å‚æ•°è®¾ç½®</h3>
            
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPreset('pokemon')">å®å¯æ¢¦æ›²çº¿</button>
                <button class="preset-btn" onclick="loadPreset('linear')">çº¿æ€§å¢é•¿</button>
                <button class="preset-btn" onclick="loadPreset('exponential')">æŒ‡æ•°å¢é•¿</button>
                <button class="preset-btn" onclick="loadPreset('balanced')">å¹³è¡¡æ¨¡å¼</button>
            </div>

            <div class="parameter-group">
                <div class="parameter-item">
                    <label for="maxLevel">æœ€å¤§ç­‰çº§</label>
                    <input type="range" id="maxLevel" min="10" max="100" value="20" oninput="updateParameters()">
                    <div class="value-display" id="maxLevelValue">20</div>
                </div>
                
                <div class="parameter-item">
                    <label for="maxMultiplier">æœ€é«˜æƒç›Šå€ç‡</label>
                    <input type="range" id="maxMultiplier" min="1" max="5" step="0.1" value="2" oninput="updateParameters()">
                    <div class="value-display" id="maxMultiplierValue">2.0x</div>
                </div>
                
                <div class="parameter-item">
                    <label for="baseExp">åŸºç¡€ç»éªŒå€¼</label>
                    <input type="range" id="baseExp" min="10" max="1000" value="100" oninput="updateParameters()">
                    <div class="value-display" id="baseExpValue">100</div>
                </div>
                
                <div class="parameter-item">
                    <label for="growthRate">å¢é•¿ç‡</label>
                    <input type="range" id="growthRate" min="1.0" max="2.0" step="0.01" value="1.5" oninput="updateParameters()">
                    <div class="value-display" id="growthRateValue">1.50</div>
                </div>
            </div>

            <div class="formula-display" id="formulaDisplay">
                å½“å‰å…¬å¼ï¼šEXP(n) = 100 Ã— (1.5^n)
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calculateLevels()">é‡æ–°è®¡ç®—</button>
                <button class="btn btn-secondary" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                <button class="btn btn-secondary" onclick="resetToDefault()">é‡ç½®é»˜è®¤</button>
            </div>
        </div>

                <div class="results-container">
            <div class="level-table">
                <h3>ğŸ“ˆ ç­‰çº§ç»éªŒè¡¨</h3>
                <table id="levelTable">
                    <thead>
                        <tr>
                            <th>ç­‰çº§</th>
                            <th>ç´¯è®¡ç»éªŒ</th>
                            <th>å‡çº§æ‰€éœ€</th>
                            <th>å¥–åŠ±å€ç‡</th>
                            <th>è§£é”æœºåˆ¶</th>
                        </tr>
                    </thead>
                    <tbody id="levelTableBody">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="exp-actions">
                <!-- ç»éªŒå¢é•¿æ›²çº¿å¯è§†åŒ– -->
                <div class="chart-container">
                    <h3>ğŸ“Š ç»éªŒå¢é•¿æ›²çº¿</h3>
                    <div class="chart-controls">
                        <label for="chartType">å›¾è¡¨ç±»å‹ï¼š</label>
                        <select id="chartType" onchange="updateChart()">
                            <option value="total">ç´¯è®¡ç»éªŒ</option>
                            <option value="required">å‡çº§æ‰€éœ€ç»éªŒ</option>
                            <option value="multiplier">å¥–åŠ±å€ç‡</option>
                        </select>
                        <button class="btn btn-secondary" onclick="toggleLogScale()">å¯¹æ•°/çº¿æ€§</button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="expChart" width="600" height="300"></canvas>
                    </div>
                    <div class="chart-info">
                        <div class="info-item">
                            <span class="info-label">æ›²çº¿ç±»å‹</span>
                            <span class="info-value" id="curveType">æŒ‡æ•°å¢é•¿</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å¢é•¿ç‡</span>
                            <span class="info-value" id="growthInfo">1.50x</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æœ€å¤§å€¼</span>
                            <span class="info-value" id="maxValue">-</span>
                        </div>
                    </div>
                </div>

                <h3>ğŸ’ª ç»éªŒè·å–æ–¹å¼</h3>
                <div class="exp-source">
                    <div class="exp-item">
                        <span class="exp-action">å®Œæˆä»»åŠ¡</span>
                        <span class="exp-value">+1 EXP</span>
                    </div>
                    <div class="exp-item">
                        <span class="exp-action">ä»£ç å®¡æŸ¥</span>
                        <span class="exp-value">+1 EXP</span>
                    </div>
                    <div class="exp-item">
                        <span class="exp-action">æå‡ºIssue</span>
                        <span class="exp-value">+1 EXP</span>
                    </div>
                    <div class="exp-item">
                        <span class="exp-action">ç¼–å†™æ–‡æ¡£</span>
                        <span class="exp-value">+1 EXP</span>
                    </div>
                </div>

                <h4>ğŸ ç­‰çº§æƒç›Š</h4>
                <div class="level-benefits">
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ«</div>
                        <span>ç­‰çº§è¶Šé«˜ï¼Œä»¤ç‰Œè·å–æ•°é‡è¶Šå¤š</span>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ’°</div>
                        <span>ä»»åŠ¡å¥–åŠ±å€ç‡éšç­‰çº§çº¿æ€§å¢é•¿</span>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ”“</div>
                        <span>é€æ­¥è§£é”é«˜çº§åŠŸèƒ½å’Œæƒé™</span>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ†</div>
                        <span>ä¸»çº¿ä»»åŠ¡ä¼˜å…ˆåˆ†é…æƒ</span>
                    </div>
                </div>

                <div class="effort-emphasis">
                    <div class="emphasis-title">ğŸ’¡ è®¾è®¡ç†å¿µ</div>
                    <div class="emphasis-text">
                        é€šè¿‡åŠªåŠ›ç¨‹åº¦è€ŒéæŠ€èƒ½æ°´å¹³æ¥åˆ†é…å¹³å°æƒç›Šï¼Œç¡®ä¿æ–°æ‰‹å’Œç»éªŒä¸°å¯Œçš„å¼€å‘è€…éƒ½èƒ½å…¬å¹³ç«äº‰ï¼Œ
                        ä¿ƒè¿›çŸ¥è¯†åˆ†äº«å’Œå›¢é˜Ÿåä½œã€‚æŠ€èƒ½è¯„ä¼°å¦æœ‰ä¸“é—¨çš„GitHubé›†æˆç³»ç»Ÿã€‚
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // é¢„è®¾é…ç½®
        const presets = {
            pokemon: {
                maxLevel: 20,
                maxMultiplier: 2.0,
                baseExp: 100,
                growthRate: 1.80
            },
            linear: {
                maxLevel: 20,
                maxMultiplier: 1.5,
                baseExp: 50,
                growthRate: 1.00
            },
            exponential: {
                maxLevel: 15,
                maxMultiplier: 3.0,
                baseExp: 10,
                growthRate: 2.00
            },
            balanced: {
                maxLevel: 25,
                maxMultiplier: 2.2,
                baseExp: 80,
                growthRate: 1.60
            }
        };

        // æœºåˆ¶è§£é”è¡¨
        const unlockMechanisms = {
            0: "ä»»åŠ¡ç³»ç»Ÿ",
            1: "ä»¤ç‰Œç³»ç»Ÿ", 
            2: "è¿èƒœæ¿€åŠ±",
            3: "å£°èª‰ç³»ç»Ÿ",
            4: "ç»„é˜Ÿç³»ç»Ÿ",
            5: "å¸ˆå¾’ç³»ç»Ÿ",
            6: "å‹‹ç« ç³»ç»Ÿ"
        };

        // åŠ è½½é¢„è®¾
        function loadPreset(presetName) {
            const preset = presets[presetName];
            if (preset) {
                document.getElementById('maxLevel').value = preset.maxLevel;
                document.getElementById('maxMultiplier').value = preset.maxMultiplier;
                document.getElementById('baseExp').value = preset.baseExp;
                document.getElementById('growthRate').value = preset.growthRate;
                updateParameters();
            }
        }

        // æ›´æ–°å‚æ•°æ˜¾ç¤º
        function updateParameters() {
            const maxLevel = document.getElementById('maxLevel').value;
            const maxMultiplier = document.getElementById('maxMultiplier').value;
            const baseExp = document.getElementById('baseExp').value;
            const growthRate = parseFloat(document.getElementById('growthRate').value);

            document.getElementById('maxLevelValue').textContent = maxLevel;
            document.getElementById('maxMultiplierValue').textContent = maxMultiplier + 'x';
            document.getElementById('baseExpValue').textContent = baseExp;
            document.getElementById('growthRateValue').textContent = growthRate.toFixed(2);

            // æ›´æ–°å…¬å¼æ˜¾ç¤º
            const formula = `EXP(n) = ${baseExp} Ã— (${growthRate.toFixed(2)}^n)`;
            document.getElementById('formulaDisplay').textContent = `å½“å‰å…¬å¼ï¼š${formula}`;

            // è‡ªåŠ¨é‡æ–°è®¡ç®—
            calculateLevels();
        }

        // è®¡ç®—ç­‰çº§æ•°æ®
        function calculateLevels() {
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const maxMultiplier = parseFloat(document.getElementById('maxMultiplier').value);
            const baseExp = parseInt(document.getElementById('baseExp').value);
            const growthRate = parseFloat(document.getElementById('growthRate').value);

            const levelData = [];
            let totalExp = 0;

            for (let level = 0; level <= maxLevel; level++) {
                let expRequired;
                
                if (level === 0) {
                    expRequired = 0;
                } else if (growthRate === 1.0) {
                    // çº¿æ€§å¢é•¿
                    expRequired = baseExp * level;
                } else {
                    // æŒ‡æ•°å¢é•¿ï¼ˆåŸºäºå®å¯æ¢¦å…¬å¼çš„ç®€åŒ–ç‰ˆï¼‰
                    if (level <= maxLevel * 0.5) {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level * 0.8));
                    } else if (level <= maxLevel * 0.8) {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level * 0.9));
                    } else {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level));
                    }
                }

                totalExp += expRequired;
                
                // è®¡ç®—æƒç›Šå€ç‡ï¼ˆçº¿æ€§åˆ†é…ï¼‰
                const multiplier = 1 + (maxMultiplier - 1) * (level / maxLevel);
                
                // è·å–è§£é”æœºåˆ¶
                const unlockMechanism = unlockMechanisms[level] || "-";

                levelData.push({
                    level: level,
                    totalExp: totalExp,
                    expRequired: expRequired,
                    multiplier: multiplier.toFixed(2),
                    unlockMechanism: unlockMechanism
                });
            }

            displayLevelTable(levelData);
        }

        // æ˜¾ç¤ºç­‰çº§è¡¨æ ¼
        function displayLevelTable(levelData) {
            const tbody = document.getElementById('levelTableBody');
            tbody.innerHTML = '';

            levelData.forEach((data, index) => {
                const row = document.createElement('tr');
                
                // é«˜äº®é‡è¦ç­‰çº§
                if (data.level % 5 === 0 && data.level > 0) {
                    row.style.backgroundColor = '#fff3cd';
                }

                row.innerHTML = `
                    <td><strong>Lv.${data.level}</strong></td>
                    <td>${data.totalExp.toLocaleString()}</td>
                    <td>${data.expRequired.toLocaleString()}</td>
                    <td>Ã—${data.multiplier}</td>
                    <td>${data.unlockMechanism}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const tableData = [];
            const rows = document.querySelectorAll('#levelTable tbody tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                tableData.push({
                    level: cells[0].textContent,
                    totalExp: cells[1].textContent,
                    expRequired: cells[2].textContent,
                    multiplier: cells[3].textContent,
                    unlockMechanism: cells[4].textContent
                });
            });

            const dataStr = JSON.stringify(tableData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'level_system_data.json';
            link.click();
        }

        // é‡ç½®åˆ°é»˜è®¤å€¼
        function resetToDefault() {
            loadPreset('balanced');
        }

        // å›¾è¡¨ç›¸å…³å˜é‡
        let chart = null;
        let currentData = [];
        let isLogScale = false;

        // ç»˜åˆ¶å›¾è¡¨
        function drawChart(levelData, chartType = 'total') {
            const canvas = document.getElementById('expChart');
            const ctx = canvas.getContext('2d');
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è·å–æ•°æ®
            let data = [];
            let maxValue = 0;
            let dataLabel = '';
            
            switch(chartType) {
                case 'total':
                    data = levelData.map(item => item.totalExp);
                    dataLabel = 'ç´¯è®¡ç»éªŒ';
                    break;
                case 'required':
                    data = levelData.map(item => item.expRequired);
                    dataLabel = 'å‡çº§æ‰€éœ€ç»éªŒ';
                    break;
                case 'multiplier':
                    data = levelData.map(item => parseFloat(item.multiplier));
                    dataLabel = 'å¥–åŠ±å€ç‡';
                    break;
            }
            
            maxValue = Math.max(...data);
            currentData = data;
            
            // æ›´æ–°å›¾è¡¨ä¿¡æ¯
            document.getElementById('maxValue').textContent = maxValue.toLocaleString();
            
            // è®¾ç½®ç”»å¸ƒå°ºå¯¸å’Œè¾¹è·
            const padding = 60;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Xè½´
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            // Yè½´
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿å’Œæ ‡ç­¾
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            
            // Xè½´æ ‡ç­¾ï¼ˆç­‰çº§ï¼‰
            const xStep = chartWidth / (levelData.length - 1);
            for (let i = 0; i < levelData.length; i += Math.ceil(levelData.length / 10)) {
                const x = padding + i * xStep;
                
                // ç½‘æ ¼çº¿
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, canvas.height - padding);
                ctx.stroke();
                
                // æ ‡ç­¾
                ctx.fillText(`Lv.${i}`, x - 15, canvas.height - padding + 20);
            }
            
            // Yè½´æ ‡ç­¾
            const ySteps = 8;
            const yStep = chartHeight / ySteps;
            const valueStep = maxValue / ySteps;
            
            for (let i = 0; i <= ySteps; i++) {
                const y = canvas.height - padding - i * yStep;
                const value = i * valueStep;
                
                // ç½‘æ ¼çº¿
                if (i > 0) {
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();
                }
                
                // æ ‡ç­¾
                let label = '';
                if (chartType === 'multiplier') {
                    label = `Ã—${value.toFixed(1)}`;
                } else if (value >= 1000000) {
                    label = `${(value / 1000000).toFixed(1)}M`;
                } else if (value >= 1000) {
                    label = `${(value / 1000).toFixed(1)}K`;
                } else {
                    label = Math.round(value).toString();
                }
                
                ctx.fillText(label, 10, y + 4);
            }
            
            // ç»˜åˆ¶æ›²çº¿
            if (data.length > 1) {
                ctx.strokeStyle = chartType === 'total' ? '#4CAF50' : 
                                 chartType === 'required' ? '#2196F3' : '#FF9800';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                for (let i = 0; i < data.length; i++) {
                    const x = padding + (i / (data.length - 1)) * chartWidth;
                    let y;
                    
                    if (isLogScale && data[i] > 0) {
                        const logValue = Math.log10(data[i]);
                        const logMax = Math.log10(maxValue);
                        y = canvas.height - padding - (logValue / logMax) * chartHeight;
                    } else {
                        y = canvas.height - padding - (data[i] / maxValue) * chartHeight;
                    }
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = ctx.strokeStyle;
                for (let i = 0; i < data.length; i++) {
                    const x = padding + (i / (data.length - 1)) * chartWidth;
                    let y;
                    
                    if (isLogScale && data[i] > 0) {
                        const logValue = Math.log10(data[i]);
                        const logMax = Math.log10(maxValue);
                        y = canvas.height - padding - (logValue / logMax) * chartHeight;
                    } else {
                        y = canvas.height - padding - (data[i] / maxValue) * chartHeight;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`${dataLabel}å¢é•¿æ›²çº¿`, padding, 30);
            
            // ç»˜åˆ¶å›¾ä¾‹
            ctx.font = '12px Arial';
            ctx.fillText(`${isLogScale ? 'å¯¹æ•°' : 'çº¿æ€§'}åæ ‡`, canvas.width - 120, 30);
        }

        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            const chartType = document.getElementById('chartType').value;
            if (currentData.length > 0) {
                // é‡æ–°è®¡ç®—æ•°æ®
                const levelData = getCurrentLevelData();
                drawChart(levelData, chartType);
            }
        }

        // åˆ‡æ¢å¯¹æ•°/çº¿æ€§åæ ‡
        function toggleLogScale() {
            isLogScale = !isLogScale;
            updateChart();
        }

        // è·å–å½“å‰ç­‰çº§æ•°æ®
        function getCurrentLevelData() {
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const maxMultiplier = parseFloat(document.getElementById('maxMultiplier').value);
            const baseExp = parseInt(document.getElementById('baseExp').value);
            const growthRate = parseFloat(document.getElementById('growthRate').value);

            const levelData = [];
            let totalExp = 0;

            for (let level = 0; level <= maxLevel; level++) {
                let expRequired;
                
                if (level === 0) {
                    expRequired = 0;
                } else if (growthRate === 1.0) {
                    expRequired = baseExp * level;
                } else {
                    if (level <= maxLevel * 0.5) {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level * 0.8));
                    } else if (level <= maxLevel * 0.8) {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level * 0.9));
                    } else {
                        expRequired = Math.floor(baseExp * Math.pow(growthRate, level));
                    }
                }

                totalExp += expRequired;
                const multiplier = 1 + (maxMultiplier - 1) * (level / maxLevel);
                const unlockMechanism = unlockMechanisms[level] || "-";

                levelData.push({
                    level: level,
                    totalExp: totalExp,
                    expRequired: expRequired,
                    multiplier: multiplier.toFixed(2),
                    unlockMechanism: unlockMechanism
                });
            }

            return levelData;
        }

        // ä¿®æ”¹åŸæœ‰çš„è®¡ç®—å‡½æ•°ï¼Œæ·»åŠ å›¾è¡¨æ›´æ–°
        function calculateLevels() {
            const levelData = getCurrentLevelData();
            displayLevelTable(levelData);
            
            // æ›´æ–°æ›²çº¿ç±»å‹ä¿¡æ¯
            const growthRate = parseFloat(document.getElementById('growthRate').value);
            let curveType = '';
            if (growthRate === 1.0) {
                curveType = 'çº¿æ€§å¢é•¿';
            } else if (growthRate <= 1.20) {
                curveType = 'ç¼“æ…¢å¢é•¿';
            } else if (growthRate <= 1.50) {
                curveType = 'æ¸©å’Œå¢é•¿';
            } else if (growthRate <= 1.80) {
                curveType = 'ä¸­ç­‰å¢é•¿';
            } else {
                curveType = 'å¿«é€Ÿå¢é•¿';
            }
            
            document.getElementById('curveType').textContent = curveType;
            document.getElementById('growthInfo').textContent = growthRate.toFixed(2) + 'x';
            
            // ç»˜åˆ¶å›¾è¡¨
            const chartType = document.getElementById('chartType').value;
            drawChart(levelData, chartType);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadPreset('balanced');
        });
    </script>
</body>
</html> 